<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‹å‹™å ±é…¬å–®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');

        :root {
            --tofu-yellow: #fefce8; 
            --tofu-primary: #eab308;
            --tofu-text: #422006;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #fef9c3;
            color: var(--tofu-text);
            margin: 0;
            padding: 0;
        }

        .section-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #fde047;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #854d0e;
            margin-bottom: 16px;
            padding-left: 10px;
            border-left: 4px solid #facc15;
        }

        .input-label {
            display: block;
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .input-control {
            width: 100%;
            border: 1px solid #fde68a;
            border-radius: 8px;
            padding: 8px 12px;
            background: #fffdf2;
            outline: none;
            transition: border-color 0.2s;
        }

        .input-control:focus {
            border-color: #facc15;
        }

        .calc-badge {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            background-color: #fef3c7;
            border: 1px solid #fcd34d;
            border-radius: 6px;
            font-size: 0.75rem;
            color: #92400e;
            margin-right: 4px;
        }

        /* å ±è¡¨å€åŸŸå„ªåŒ– */
        .preview-wrapper {
            background: #d4d4d4;
            padding: 40px 0;
            display: flex;
            justify-content: center;
            /* è®“æ‰‹æ©Ÿå¯ä»¥æ©«å‘æ²å‹•é è¦½ */
            overflow-x: auto; 
        }

        .a4-page {
            width: 210mm;
            min-height: 297mm;
            background: white;
            padding: 10mm 15mm;
            box-sizing: border-box;
            color: black;
            position: relative;
            /* ç§»é™¤ overflow: hiddenï¼Œè®“å…§å®¹å¯ä»¥æ ¹æ“šæ‰‹æ©Ÿç¸®æ”¾ */
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 8px;
        }

        .report-table th, .report-table td {
            border: 1px solid #000;
            padding: 5px 10px;
            font-size: 13px;
            text-align: left;
        }

        .label-cell {
            background-color: #fffde7;
            font-weight: bold;
            width: 130px;
        }

        .attachment-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 8px;
        }

        .box-placeholder {
            border: 1px dashed #999;
            height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fafafa;
            font-size: 11px;
            color: #888;
            overflow: hidden;
            position: relative;
        }

        .box-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            position: absolute;
            top: 0;
            left: 0;
        }

        @media print {
            body { background: white !important; }
            .no-print { display: none !important; }
            .preview-wrapper { background: white !important; padding: 0 !important; display: block !important; overflow: visible !important; }
            .a4-page { 
                box-shadow: none !important; 
                margin: 0 !important; 
                border: none !important; 
                width: 210mm !important;
                height: 297mm !important;
                padding: 10mm 15mm !important;
                /* é˜²æ­¢ç¸®æ”¾å°è‡´çš„åˆ†é  */
                page-break-after: avoid;
                page-break-before: avoid;
            }
            @page { 
                size: A4; 
                margin: 0; 
            }
        }

        /* é‡å°æ‰‹æ©Ÿé¡¯ç¤ºçš„å¾®èª¿ï¼Œä¸å½±éŸ¿åˆ—å° */
        @media screen and (max-width: 210mm) {
            .preview-wrapper {
                padding: 20px 10px;
            }
            /* è®“ A4 é è¦½åœ¨æ‰‹æ©Ÿä¸Šç¸®æ”¾é¡¯ç¤ºï¼Œä¸æ’é–‹è¦–çª— */
            .a4-page {
                transform-origin: top left;
                /* é ç•™ä¸€é»å¯¬åº¦ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥è‡ªå·±æ‰‹æŒ‡ç¸®æ”¾ */
            }
        }
    </style>
</head>
<body>

    <div class="no-print max-w-4xl mx-auto py-8 px-4">
        <div class="flex items-center gap-3 mb-6">
            <div class="w-10 h-10 bg-yellow-400 rounded-lg flex items-center justify-center text-white text-2xl">ğŸ§¾</div>
            <h1 class="text-3xl font-black">å‹å‹™å ±é…¬å–® <span class="text-sm font-normal text-yellow-700">| é ˜æ“šå°ç®¡å®¶</span></h1>
        </div>

        <div class="section-card">
            <h2 class="section-title">1. æ‰€å¾—äººåŸºæœ¬è³‡æ–™</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="input-label">å§“å</label>
                    <input type="text" id="in_name" class="input-control" placeholder="è¼¸å…¥å§“å">
                </div>
                <div>
                    <label class="input-label">Email</label>
                    <input type="email" id="in_email" class="input-control">
                </div>
                <div>
                    <label class="input-label">åœ‹ç±</label>
                    <select id="in_nationality" class="input-control">
                        <option value="local">æœ¬åœ‹äºº</option>
                        <option value="foreign_short">å¤–åœ‹äººåœ¨è‡ºæœªæ»¿ 183 å¤©</option>
                        <option value="foreign_long">å¤–åœ‹äººåœ¨è‡ºå¾…æ»¿ 183 å¤©</option>
                    </select>
                </div>
                <div>
                    <label class="input-label">èº«åˆ†è­‰å­—è™Ÿ</label>
                    <input type="text" id="in_id" class="input-control">
                </div>
                <div class="md:col-span-2">
                    <label class="input-label">æˆ¶ç±åœ°å€</label>
                    <input type="text" id="in_address" class="input-control">
                </div>
                <div>
                    <label class="input-label">è¯çµ¡é›»è©±</label>
                    <input type="text" id="in_phone" class="input-control">
                </div>
                <div>
                    <label class="input-label">å…æ‰£äºŒä»£å¥ä¿</label>
                    <select id="in_union" class="input-control">
                        <option value="å¦">å¦ (éœ€æ‰£äºŒä»£å¥ä¿)</option>
                        <option value="æ˜¯">æ˜¯ (å…æ‰£äºŒä»£å¥ä¿)</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="section-card">
            <h2 class="section-title">2. å‹å ±è³‡æ–™</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="md:col-span-2">
                    <label class="input-label">ç”³å ±é¡åˆ¥</label>
                    <select id="in_category" class="input-control">
                        <option value="9A">9A åŸ·è¡Œæ¥­å‹™æ‰€å¾—</option>
                        <option value="9B">9B ç¨¿è²» (å…ç¨…é¡å…§ä¸è¨ˆ)</option>
                        <option value="50">50 è–ªè³‡æ‰€å¾—</option>
                        <option value="92">92 å…¶ä»–æ‰€å¾—</option>
                    </select>
                </div>
                <div class="md:col-span-2">
                    <label class="input-label">åŸ·è¡Œæ¥­å‹™é¡åˆ¥</label>
                    <select id="in_exec_type" class="input-control">
                        <option value="0" data-rate="0">è«‹é¸æ“‡é¡åˆ¥...</option>
                        <option value="10" data-rate="30">10 å¾‹å¸« (30%)</option>
                        <option value="11" data-rate="35">11 æœƒè¨ˆå¸« (35%)</option>
                        <option value="20" data-rate="35">20 æŠ€å¸« (35%)</option>
                        <option value="70" data-rate="45">70 è¡¨æ¼”äºº (45%)</option>
                        <option value="92" data-rate="20">92 ç¨‹å¼è¨­è¨ˆå¸« (20%)</option>
                        <option value="98" data-rate="30">98 ç¨¿è²»/æ¼”è¬›é˜é»-éè‡ªè¡Œå‡ºç‰ˆ (30%)</option>
                        <option value="99" data-rate="75">99 ç¨¿è²»/ç‰ˆç¨…-è‡ªè¡Œå‡ºç‰ˆ (75%)</option>
                    </select>
                </div>
                <div>
                    <div class="flex items-center justify-between mb-1">
                        <label class="input-label mb-0">çµ¦ä»˜ç¸½é‡‘é¡</label>
                        <div id="quick_calc" class="flex">
                            <span class="calc-badge">æ‰£ç¹³ï¼š <span id="badge_tax">0</span></span>
                            <span class="calc-badge">äºŒä»£å¥ä¿ï¼š <span id="badge_health">0</span></span>
                        </div>
                    </div>
                    <input type="number" id="in_amount" class="input-control font-bold text-lg text-yellow-900" value="0">
                </div>
                <div>
                    <label class="input-label">å‹å‹™å…§å®¹</label>
                    <input type="text" id="in_content" class="input-control" placeholder="ä¾‹å¦‚ï¼šæ–‡æ¡ˆæ’°å¯«">
                </div>
                <div>
                    <label class="input-label">å‹å‹™é–‹å§‹æ—¥æœŸ</label>
                    <input type="date" id="in_start" class="input-control">
                </div>
                <div>
                    <label class="input-label">å‹å‹™çµæŸæ—¥æœŸ</label>
                    <input type="date" id="in_end" class="input-control">
                </div>
            </div>
        </div>

        <div class="section-card">
            <h2 class="section-title">3. å…¬å¸åç¨±æ”¯ä»˜è³‡æ–™</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="md:col-span-2">
                    <label class="input-label">æ”¯ä»˜æ¬¾é …å…¬å¸åç¨±</label>
                    <input type="text" id="in_company" class="input-control" placeholder="OOæœ‰é™å…¬å¸">
                </div>
                <div>
                    <label class="input-label">ä»˜æ¬¾æ–¹å¼</label>
                    <select id="in_pay_method" class="input-control">
                        <option value="åŒ¯æ¬¾">åŒ¯æ¬¾</option>
                        <option value="ç¾é‡‘">ç¾é‡‘</option>
                        <option value="æ”¯ç¥¨">æ”¯ç¥¨</option>
                    </select>
                </div>
                <div>
                    <label class="input-label">çµ¦ä»˜æ—¥æœŸ</label>
                    <input type="date" id="in_pay_date" class="input-control">
                </div>
                <div>
                    <label class="input-label">éŠ€è¡Œåç¨±</label>
                    <input type="text" id="in_bank" class="input-control">
                </div>
                <div>
                    <label class="input-label">åˆ†è¡Œ</label>
                    <input type="text" id="in_branch" class="input-control">
                </div>
                <div>
                    <label class="input-label">æˆ¶å</label>
                    <input type="text" id="in_acc_name" class="input-control">
                </div>
                <div>
                    <label class="input-label">å¸³è™Ÿ</label>
                    <input type="text" id="in_acc_no" class="input-control">
                </div>
            </div>
        </div>

        <div class="section-card">
            <h2 class="section-title">4. é™„ä»¶ä¸Šå‚³</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="input-label text-xs">èº«åˆ†è­‰æ­£é¢</label>
                    <input type="file" id="up_front" accept="image/*" class="text-xs">
                </div>
                <div>
                    <label class="input-label text-xs">èº«åˆ†è­‰åé¢</label>
                    <input type="file" id="up_back" accept="image/*" class="text-xs">
                </div>
                <div>
                    <label class="input-label text-xs">å­˜æ‘ºå°é¢</label>
                    <input type="file" id="up_passbook" accept="image/*" class="text-xs">
                </div>
            </div>
            <div class="mt-8">
                <button onclick="window.print()" class="w-full bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-bold py-4 rounded-xl shadow-lg transition transform hover:-translate-y-0.5">
                    é»æˆ‘ç”¢ç”Ÿå‹å ±å–® (PDF)
                </button>
            </div>
        </div>
    </div>

    <div class="preview-wrapper">
        <div class="a4-page" id="printable_page">
            <div class="text-center mb-4">
                <h1 class="text-xl font-bold border-b-2 border-black inline-block px-12 pb-1" id="out_company_title">ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿</h1>
                <h2 class="text-lg font-bold mt-2 tracking-widest">å‹ å‹™ å ± é…¬ å–®</h2>
            </div>

            <div class="text-right text-xs mb-1">çµ¦ä»˜æ—¥æœŸï¼š<span id="out_pay_date"></span></div>

            <table class="report-table">
                <tr>
                    <td class="label-cell">æ‰€å¾—äººå§“å</td>
                    <td id="out_name" class="w-1/3"></td>
                    <td class="label-cell">èº«åˆ†è­‰å­—è™Ÿ</td>
                    <td id="out_id"></td>
                </tr>
                <tr>
                    <td class="label-cell">é›»å­éƒµä»¶</td>
                    <td id="out_email"></td>
                    <td class="label-cell">è¯çµ¡é›»è©±</td>
                    <td id="out_phone"></td>
                </tr>
                <tr>
                    <td class="label-cell">åœ‹ç±</td>
                    <td id="out_nationality"></td>
                    <td class="label-cell">å…æ‰£äºŒä»£å¥ä¿</td>
                    <td id="out_union"></td>
                </tr>
                <tr>
                    <td class="label-cell">æˆ¶ç±åœ°å€</td>
                    <td colspan="3" id="out_address"></td>
                </tr>
            </table>

            <table class="report-table mt-3">
                <tr>
                    <td class="label-cell">ç”³å ±é¡åˆ¥</td>
                    <td id="out_category" class="w-1/3"></td>
                    <td class="label-cell">åŸ·è¡Œæ¥­å‹™ä»£è™Ÿ</td>
                    <td id="out_exec_type"></td>
                </tr>
                <tr>
                    <td class="label-cell">å‹å‹™å…§å®¹</td>
                    <td colspan="3" id="out_content"></td>
                </tr>
                <tr>
                    <td class="label-cell">å‹å‹™æœŸé–“</td>
                    <td colspan="3"><span id="out_start"></span> ï½ <span id="out_end"></span></td>
                </tr>
            </table>

            <div class="flex border border-black border-t-0 -mt-[1px]">
                <div class="w-1/2 p-3 border-r border-black">
                    <p class="font-bold border-b border-black mb-2 text-center text-sm">çµ¦ä»˜é‡‘é¡è©¦ç®—</p>
                    <div class="text-xs space-y-1">
                        <div class="flex justify-between"><span>çµ¦ä»˜ç¸½é‡‘é¡ï¼š</span><span id="calc_total">0</span></div>
                        <div class="flex justify-between"><span>ä»£æ‰£æ‰€å¾—ç¨…ï¼š</span><span id="calc_tax">0</span></div>
                        <div class="flex justify-between"><span>äºŒä»£å¥ä¿è²»ï¼š</span><span id="calc_health">0</span></div>
                        <div class="flex justify-between font-bold border-t border-black pt-1 mt-1 text-sm">
                            <span>å¯¦éš›æ”¯ä»˜é‡‘é¡ï¼š</span><span id="calc_net">0</span>
                        </div>
                    </div>
                </div>
                <div class="w-1/2 p-3 flex flex-col justify-between">
                    <p class="font-bold text-sm">æ‰€å¾—äººç°½ç« ï¼š</p>
                    <div class="border-b border-dotted border-gray-400 mb-2 mt-12"></div>
                </div>
            </div>

            <table class="report-table mt-3">
                <tr>
                    <th colspan="4" class="label-cell text-center py-1">æ”¯ä»˜è³‡æ–™</th>
                </tr>
                <tr>
                    <td class="label-cell">ä»˜æ¬¾æ–¹å¼</td>
                    <td id="out_pay_method"></td>
                    <td class="label-cell">éŠ€è¡Œ/åˆ†è¡Œ</td>
                    <td><span id="out_bank"></span> <span id="out_branch"></span></td>
                </tr>
                <tr>
                    <td class="label-cell">æ‰€å¾—äººæˆ¶å</td>
                    <td id="out_acc_name"></td>
                    <td class="label-cell">æ‰€å¾—äººå¸³è™Ÿ</td>
                    <td id="out_acc_no"></td>
                </tr>
            </table>

            <div class="mt-4">
                <p class="text-[10px] font-bold mb-1">é™„ä»¶ï¼šèº«åˆ†è­‰æ­£åé¢å½±æœ¬èˆ‡å­˜æ‘ºå°é¢</p>
                <div class="attachment-grid">
                    <div class="box-placeholder" id="p_front">èº«åˆ†è­‰æ­£é¢</div>
                    <div class="box-placeholder" id="p_back">èº«åˆ†è­‰åé¢</div>
                    <div class="box-placeholder col-span-2" style="height: 225px;" id="p_passbook">å­˜æ‘ºå°é¢</div>
                </div>
            </div>

            <div class="absolute bottom-6 left-10 right-10 text-[9px] text-gray-400 border-t pt-2 italic">
                â€» çµ¦ä»˜å¾Œï¼Œè«‹å‚³çµ¦äº‹å‹™æ‰€ç”³å ±æ‰£ç¹³ï¼Œä»¥å…å—ç½°ã€‚   åŸ·è¡Œæ¥­å‹™æ‰£ç¹³10%é–€æª» $20,010ï¼›äºŒä»£å¥ä¿2.11%æ‰£ç¹³é–€æª» $20,000ã€‚
            </div>
        </div>
    </div>

    <script>
        function sync() {
            const fields = ['name', 'email', 'id', 'address', 'phone', 'content', 'start', 'end', 'bank', 'branch', 'acc_name', 'acc_no', 'pay_method'];
            fields.forEach(id => {
                const el = document.getElementById('in_' + id);
                const out = document.getElementById('out_' + id);
                if (el && out) out.innerText = el.value;
            });

            const payDateVal = document.getElementById('in_pay_date').value;
            if (payDateVal) {
                const d = new Date(payDateVal);
                document.getElementById('out_pay_date').innerText = `${d.getFullYear()-1911}å¹´${d.getMonth()+1}æœˆ${d.getDate()}æ—¥`;
            }

            document.getElementById('out_company_title').innerText = document.getElementById('in_company').value || 'ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿ï¼¿';

            const nat = document.getElementById('in_nationality');
            document.getElementById('out_nationality').innerText = nat.options[nat.selectedIndex].text;
            
            const union = document.getElementById('in_union');
            document.getElementById('out_union').innerText = union.value;

            const cat = document.getElementById('in_category');
            document.getElementById('out_category').innerText = cat.options[cat.selectedIndex].text;

            const exec = document.getElementById('in_exec_type');
            document.getElementById('out_exec_type').innerText = exec.value === "0" ? "ç„¡" : exec.options[exec.selectedIndex].text;

            const amount = parseFloat(document.getElementById('in_amount').value) || 0;
            const nationality = document.getElementById('in_nationality').value;
            const catVal = document.getElementById('in_category').value;
            const unionVal = document.getElementById('in_union').value;

            let tax = 0;
            let health = 0;

            if (nationality === 'local' || nationality === 'foreign_long') {
                if ((catVal === '9A' || catVal === '9B') && amount >= 20010) {
                    tax = Math.round(amount * 0.1);
                } else if (catVal === '50' && amount >= 90500) {
                    tax = Math.round(amount * 0.05);
                }
                if (unionVal === 'å¦' && amount >= 20000) {
                    health = Math.round(amount * 0.0211);
                }
            } else {
                if (catVal === '9A' || catVal === '9B') { tax = Math.round(amount * 0.20); } 
                else if (catVal === '50') { tax = Math.round(amount * 0.18); }
                if (unionVal === 'å¦' && amount >= 20000) { health = Math.round(amount * 0.0211); }
            }

            const net = amount - tax - health;
            document.getElementById('calc_total').innerText = amount.toLocaleString() + ' å…ƒ';
            document.getElementById('calc_tax').innerText = tax.toLocaleString() + ' å…ƒ';
            document.getElementById('calc_health').innerText = health.toLocaleString() + ' å…ƒ';
            document.getElementById('calc_net').innerText = net.toLocaleString() + ' å…ƒ';
            document.getElementById('badge_tax').innerText = tax.toLocaleString();
            document.getElementById('badge_health').innerText = health.toLocaleString();
        }

        function bindImage(upId, prevId) {
            document.getElementById(upId).addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (ev) => {
                        document.getElementById(prevId).innerHTML = `<img src="${ev.target.result}">`;
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
        bindImage('up_front', 'p_front');
        bindImage('up_back', 'p_back');
        bindImage('up_passbook', 'p_passbook');

        document.querySelectorAll('input, select').forEach(el => el.addEventListener('input', sync));
        
        window.onload = () => {
            const today = new Date();
            document.getElementById('in_pay_date').valueAsDate = today;
            sync();
        };
    </script>
</body>
</html>

